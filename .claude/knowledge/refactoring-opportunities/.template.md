---
id: refactor-[category]-[component]-[timestamp]
component: [component-name or file path]
category: [code-smell|architecture|performance|security|maintainability|scalability|tech-debt]
priority: [low|medium|high|critical]
estimated_effort: [hours or days]
estimated_impact: [low|medium|high]
roi_score: 0.0
identified_at: [ISO-8601 timestamp]
status: [identified|planned|in-progress|completed|deferred|rejected]
tags: []
---

## Current State

### Component Overview
[Description of the component or area needing refactoring]

**Location**: `[file paths or component names]`

**Size**: [lines of code, number of files, complexity metrics]

**Current Implementation**:
```[language]
[Code snippet showing current problematic implementation]
```

### Issues

#### Issue 1: [Issue Name]
**Type**: [Code smell|Anti-pattern|Performance issue|Security risk|etc]

**Severity**: [Low|Medium|High|Critical]

**Description**: [Detailed explanation of the problem]

**Evidence**:
```
[Metrics, error logs, or data demonstrating the issue]
Cyclomatic complexity: [value]
Code duplication: [percentage]
Test coverage: [percentage]
Performance: [metrics]
```

#### Issue 2: [Another Issue]
[Repeat structure]

### Impact Assessment

**Current Pain Points**:
- Development velocity: [How this slows development]
- Bug frequency: [How this causes bugs]
- Performance: [How this affects performance]
- Maintainability: [How this makes maintenance harder]

**Quantified Impact**:
```
Bugs related to this area: [count] in last [timeframe]
Average time to modify: [hours/days]
Production incidents: [count] in last [timeframe]
Performance degradation: [percentage or metrics]
```

## Proposed Refactoring

### Approach
[High-level description of the refactoring strategy]

### Design

**Target Architecture**:
```
[Diagram or description of the improved design]
```

**Target Implementation**:
```[language]
[Code snippet showing the proposed implementation]
```

### Technical Details

**Patterns to Apply**:
- `[pattern-id-1]` - [Pattern name]
- `[pattern-id-2]` - [Pattern name]

**Anti-Patterns to Remove**:
- `[anti-pattern-id-1]` - [Anti-pattern name]
- `[anti-pattern-id-2]` - [Anti-pattern name]

**Key Changes**:
1. [Change 1] - [Rationale]
2. [Change 2] - [Rationale]
3. [Change 3] - [Rationale]

## Benefits

### Quantified Benefits

**Development Velocity**:
- Estimated time to modify: [before] → [after] ([X]% improvement)
- Code complexity: [before] → [after] ([X]% reduction)
- Lines of code: [before] → [after] ([X]% reduction)

**Quality Improvements**:
- Test coverage: [before]% → [after]% ([X]% increase)
- Expected bug reduction: [X]%
- Code maintainability index: [before] → [after]

**Performance Improvements**:
- Response time: [before] → [after] ([X]% improvement)
- Memory usage: [before] → [after] ([X]% reduction)
- Throughput: [before] → [after] ([X]% improvement)

**Business Impact**:
- Reduced time to implement new features: [estimate]
- Decreased bug fix time: [estimate]
- Improved system reliability: [estimate]

### Qualitative Benefits
- [Benefit 1: e.g., "Easier onboarding for new developers"]
- [Benefit 2: e.g., "Better alignment with domain model"]
- [Benefit 3: e.g., "Enables future architectural improvements"]

## Estimated Effort

### Breakdown
```
Analysis & Design: [hours]
Implementation: [hours]
Testing: [hours]
Code Review: [hours]
Documentation: [hours]
Deployment: [hours]
---
Total: [hours]
```

### Team Allocation
- [Role 1]: [hours]
- [Role 2]: [hours]

### Timeline
```
Week 1: [Activities]
Week 2: [Activities]
[etc]

Total duration: [weeks/days]
```

## Risks

### Technical Risks

#### Risk 1: [Risk Name]
**Probability**: [Low|Medium|High]
**Impact**: [Low|Medium|High]
**Description**: [What could go wrong]
**Mitigation**: [How to prevent or handle this risk]

#### Risk 2: [Another Risk]
[Repeat structure]

### Business Risks
- [Risk 1]: [Description and mitigation]
- [Risk 2]: [Description and mitigation]

### Rollback Plan
```
If refactoring fails or causes issues:
1. [Rollback step 1]
2. [Rollback step 2]

Rollback time: [estimate]
```

## Migration Strategy

### Approach
[Big bang|Incremental|Parallel run|Strangler pattern|etc]

**Rationale**: [Why this approach]

### Phases

#### Phase 1: [Phase Name]
**Objective**: [What this phase achieves]

**Steps**:
1. [Step 1]
2. [Step 2]

**Validation**: [How to verify this phase succeeded]

**Rollback point**: [Yes|No] - [Details]

#### Phase 2: [Next Phase]
[Repeat structure]

### Feature Flags
```
[If using feature flags]
Flag name: [name]
Rollout strategy: [gradual|instant|etc]
Monitoring: [metrics to track]
```

### Data Migration
```
[If data migration is needed]
Old schema: [description]
New schema: [description]
Migration script: [location]
Validation: [how to verify]
```

### Zero-Downtime Strategy
[How to refactor without downtime, if applicable]

## Testing Strategy

### Test Coverage Goals
- Unit test coverage: [target]%
- Integration test coverage: [target]%
- E2E test scenarios: [count]

### Test Plan
```
1. Unit tests for new implementation
2. Integration tests for interfaces
3. E2E tests for critical paths
4. Performance tests to verify improvements
5. Security tests if applicable
6. Regression tests for unchanged functionality
```

### Validation Criteria
- [ ] All existing tests pass
- [ ] New tests achieve coverage goals
- [ ] Performance metrics meet targets
- [ ] No new bugs introduced
- [ ] Feature parity maintained

## Success Metrics

### Acceptance Criteria
- [ ] [Criterion 1]
- [ ] [Criterion 2]
- [ ] [Criterion 3]

### Performance Targets
```
Metric 1: Current [value] → Target [value]
Metric 2: Current [value] → Target [value]
```

### Quality Targets
```
Code complexity: < [value]
Test coverage: > [percentage]%
Bug density: < [value] per KLOC
```

### Monitoring
**Metrics to track post-refactoring**:
- [Metric 1]
- [Metric 2]
- [Metric 3]

**Alert thresholds**: [When to investigate]

## ROI Calculation

### Impact Score: [1-10]
```
Performance improvement: [weight] × [score] = [subtotal]
Maintainability improvement: [weight] × [score] = [subtotal]
Bug reduction: [weight] × [score] = [subtotal]
Developer velocity: [weight] × [score] = [subtotal]
---
Total Impact: [score]
```

### Effort Score: [1-10]
```
Hours required: [hours] → [score]
Complexity: [low|medium|high] → [score]
Risk: [low|medium|high] → [score]
---
Total Effort: [score]
```

### ROI = Impact / Effort = [value]

**Interpretation**:
- ROI > 2.0: High value, prioritize
- ROI 1.0-2.0: Good value, plan for next cycle
- ROI 0.5-1.0: Moderate value, consider when resources available
- ROI < 0.5: Low value, defer or reject

### Financial ROI (if applicable)
```
Cost: [hours] × [hourly rate] = $[amount]
Savings: [hours saved per month] × [hourly rate] × [months] = $[amount]
Break-even: [months]
```

## Priority Justification

### Why [Low|Medium|High|Critical]

**Priority**: [Low|Medium|High|Critical]

**Justification**: [Detailed explanation]

**Factors**:
- Business impact: [explanation]
- Technical risk: [explanation]
- Effort required: [explanation]
- ROI: [value]
- Urgency: [explanation]

### Compared to Other Refactorings
[How this ranks against other identified opportunities]

## Dependencies

### Blockers
- [Blocker 1]: Must complete [X] first
- [Blocker 2]: Requires [Y] to be available

### Dependent Work
[What else depends on this refactoring]

### Team Availability
[Required team members and their availability]

### Resource Requirements
- [Resource 1]: [Need or constraint]
- [Resource 2]: [Need or constraint]

## Related Refactorings

### Prerequisite Refactorings
- `[refactor-id-1]` - Must complete before this
- `[refactor-id-2]` - Should complete before this

### Complementary Refactorings
- `[refactor-id-3]` - Could be done together
- `[refactor-id-4]` - Related but independent

### Follow-up Refactorings
- `[refactor-id-5]` - Enabled by this refactoring
- `[refactor-id-6]` - Natural next step

## References
- `[pattern-id]` - Target pattern
- `[anti-pattern-id]` - Anti-pattern to remove
- [Code review findings](URL)
- [Performance analysis](URL)
- [Architecture discussion](URL)

## Status Tracking

### Status: [Identified|Planned|In Progress|Completed|Deferred|Rejected]

### Timeline
- **Identified**: [YYYY-MM-DD]
- **Planned for**: [YYYY-MM-DD or "Next quarter"]
- **Started**: [YYYY-MM-DD]
- **Completed**: [YYYY-MM-DD]

### Completion Checklist
- [ ] Design approved
- [ ] Implementation complete
- [ ] Tests written and passing
- [ ] Performance validated
- [ ] Code reviewed
- [ ] Documentation updated
- [ ] Deployed to production
- [ ] Monitoring confirmed
- [ ] Retrospective completed

## Retrospective (Post-Completion)

### Actual vs Estimated

**Effort**:
- Estimated: [hours]
- Actual: [hours]
- Variance: [percentage]

**Impact**:
- Estimated: [metrics]
- Actual: [metrics]
- Variance: [percentage]

**ROI**:
- Predicted: [value]
- Actual: [value]

### What Went Well
- [Success 1]
- [Success 2]

### What Could Be Improved
- [Learning 1]
- [Learning 2]

### Lessons Learned
- [Lesson 1]
- [Lesson 2]

### Recommendations for Future Refactorings
- [Recommendation 1]
- [Recommendation 2]

## Revision History
- [YYYY-MM-DD]: Opportunity identified
- [YYYY-MM-DD]: Analysis completed, ROI calculated
- [YYYY-MM-DD]: Planned for [timeframe]
- [YYYY-MM-DD]: Implementation started
- [YYYY-MM-DD]: Completed and deployed
